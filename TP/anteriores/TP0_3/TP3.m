clear all;clc;

dx=5/1000;          %paso
L=310/1000;         %longitud total
n=L/dx+1;           %cantidad de nodos =63
x=linspace(0,L,n);  %vector equidistanciado

E=2e11;             %modulo de young
F=-20*9.81;         %fuerza
M=F*(L-x);          %momento

%calcula long de cada intervalo de sección cte
l1=80/1000;
l2=30/1000;
l3=100/1000;
l4=10/1000;
l5=90/1000;

%calcula los nodos donde empieza una nueva sección
n1=l1/dx+1;
n2=n1+l2/dx;
n3=n2+l3/dx;
n4=n3+l4/dx;
n5=n4+l5/dx;

%========================
m=(20-30)/(110-80); %pendiente de la sección 2
h=30-(20-30)/(110-80)*80;
H=[30*ones(1,n1) 85*m+h 90*m+h 95*m+h 100*m+h 105*m+h 20*ones(1,n4-n2) 12.5*ones(1,n5-n4+1)];
%H=la dist de la fibra máxima. Va siguiendo la silueta de la pieza.
H=H*2/1000;
B=40/1000;
e1=2/1000;          %espesores de secciones
e2=4/1000;          %espesores de secciones
%========================

%calcula las inercias de cada sección, la inercia es cte en la mayoria
%menos en la segunda (ver q es inclinada)
I=zeros(1,n);  
I(1:n1)=B*H(1).^3/12-(B-2*e1)*(H(1)-2*e1).^3/12;
I(n1+1:n2-1)=B*H(n1+1:n2-1).^3/12-(B-2*e1)*(H(n1+1:n2-1)-2*e1).^3/12;
I(n2:n3)=B*H(n2).^3/12-(B-2*e1)*(H(n2)-2*e1).^3/12;
I(n3+1)=B*H(n3+1).^3/12;
I(n4:n5)=pi*(H(n4)^4-(H(n4)-2*e2)^4)/64;

%construimos le sist de Ax=b para la deriv. segunda de MDF
K=zeros(n);f=zeros(n,1);
K(1,1)=1;
K(n,n-1:n)=[-1 1];
for i=2:n-1
    K(i,i-1)=1; %componente de la deriv. segunda por MDF
    K(i,i)=-2;  %componente de la deriv. segunda por MDF
    K(i,i+1)=1; %componente de la deriv. segunda por MDF
    f(i)=M(i)/E/I(i)*dx^2; %término independiente
end

Q=trapz(M./I)*dx; %calculo valor de la distorción angular para imponerla 
%como cond de contorno
f(n)=Q/E*dx;    %impongo la cond de contorno e x=n (nodo 63) la integral 
%calc. en el paso anterior
u=linsolve(K,f);
y=u*1000; %obtengo la deflexión
sigma=M.*H/2./I; %cálculo tensión máxima

figure(1)
plotdefl(1000*x,y',1000*H,500)
figure(2)
plotten(1000*x,y',1000*H,sigma,500)

%valores de tensión obtenidos por solidWorks
ten_SW=[
5.788e+006  
8.891e+006  
8.709e+006  
8.709e+006  
8.769e+006  
8.869e+006  
8.708e+006  
8.652e+006  
8.496e+006  
8.282e+006  
8.171e+006  
7.787e+006  
7.594e+006  
7.161e+006  
6.632e+006  
7.212e+006  
1.130e+007  
5.863e+006  
5.084e+006  
5.476e+006  
5.872e+006  
9.770e+006  
1.442e+007  
1.067e+007  
6.524e+006  
6.358e+006  
7.390e+006  
6.644e+006  
7.395e+006  
7.515e+006  
7.734e+006  
7.631e+006  
7.720e+006  
7.528e+006  
7.478e+006  
7.275e+006  
7.240e+006  
7.174e+006  
7.319e+006  
7.343e+006  
7.428e+006  
7.401e+006  
7.488e+006  
3.811e+006  
7.188e+006  
1.614e+007  
1.282e+007  
1.246e+007  
1.159e+007  
1.112e+007  
1.002e+007  
9.400e+006  
8.333e+006  
7.701e+006  
6.668e+006  
6.006e+006  
4.996e+006  
4.295e+006  
3.323e+006  
2.664e+006  
2.079e+006  
1.732e+006  
2.490e+006  ]';
%{
ten_SW=[
9.403e+006  
9.544e+006  
9.343e+006  
8.951e+006  
8.903e+006  
8.734e+006  
8.568e+006  
8.289e+006  
8.170e+006  
7.666e+006  
7.547e+006  
6.682e+006  
6.131e+006  
4.817e+006  
1.301e+006  
1.805e+005  
-6.559e+006  
-1.995e+006  
2.463e+006  
4.561e+006  
6.566e+006  
1.091e+007  
1.673e+007  
1.108e+007  
7.650e+006  
6.754e+006  
8.584e+006  
7.461e+006  
8.528e+006  
8.169e+006  
8.139e+006  
7.870e+006  
7.893e+006  
7.623e+006  
7.472e+006  
7.237e+006  
7.073e+006  
6.917e+006  
6.840e+006  
6.661e+006  
6.475e+006  
6.266e+006  
6.599e+006  
1.787e+006  
7.690e+006  
1.572e+007  
1.312e+007  
1.240e+007  
1.149e+007  
1.108e+007  
9.967e+006  
9.394e+006  
8.282e+006  
7.690e+006  
6.626e+006  
5.987e+006  
4.952e+006  
4.278e+006  
3.302e+006  
2.699e+006  
2.132e+006  
1.617e+006  
6.448e+005  ];
%}

%valores de deflexión obtenidos por solidWorks
y_SW=[
1.00000000e-030  
2.13386695e-004  
4.83282405e-004  
8.03419505e-004  
1.15103764e-003  
1.53436256e-003  
1.94512110e-003  
2.40495265e-003  
2.90667871e-003  
3.48557252e-003  
4.12792200e-003  
4.88563441e-003  
5.73526602e-003  
6.71109557e-003  
7.76015874e-003  
8.65617953e-003  
9.24902409e-003  
9.01313964e-003  
8.44000932e-003  
7.79307727e-003  
7.17669493e-003  
6.88217068e-003  
7.27002509e-003  
8.56435671e-003  
1.03009669e-002  
1.21919466e-002  
1.40141221e-002  
1.58727914e-002  
1.76371019e-002  
1.94306746e-002  
2.11986098e-002  
2.29718834e-002  
2.47589741e-002  
2.65744124e-002  
2.84243636e-002  
3.03120036e-002  
3.22451517e-002  
3.42212468e-002  
3.62498686e-002  
3.83192040e-002  
4.04097475e-002  
4.24636938e-002  
4.44035865e-002  
4.63276766e-002  
4.79780510e-002  
5.04893772e-002  
5.31101190e-002  
5.58236837e-002  
5.86331859e-002  
6.15385883e-002  
6.45471364e-002  
6.76447079e-002  
7.08300471e-002  
7.40884170e-002  
7.74184987e-002  
8.08067694e-002  
8.42507109e-002  
8.77370387e-002  
9.12628099e-002  
9.48166028e-002  
9.83996987e-002  
1.02025688e-001  
1.05717964e-001  ]';


%{
y_SW=[
0.00000000e+000  
-6.57271376e-005  
-2.28205390e-004  
-4.82807198e-004  
-7.70992017e-004  
-1.09659438e-003  
-1.46307307e-003  
-1.88283867e-003  
-2.36088713e-003  
-2.91998638e-003  
-3.56061687e-003  
-4.31822333e-003  
-5.18632261e-003  
-6.18047453e-003  
-7.26321852e-003  
-8.19461141e-003  
-8.81657377e-003  
-8.56006518e-003  
-7.85749312e-003  
-6.95335027e-003  
-6.00345992e-003  
-5.33916336e-003  
-5.55997528e-003  
-6.96893316e-003  
-8.91503133e-003  
-1.09866923e-002  
-1.29118692e-002  
-1.48457810e-002  
-1.66598149e-002  
-1.84858870e-002  
-2.02797279e-002  
-2.20732745e-002  
-2.38758158e-002  
-2.57055312e-002  
-2.75677070e-002  
-2.94679012e-002  
-3.14122364e-002  
-3.33999135e-002  
-3.54384407e-002  
-3.75178196e-002  
-3.96172032e-002  
-4.16783802e-002  
-4.36248817e-002  
-4.55606729e-002  
-4.76454198e-002  
-5.01259752e-002  
-5.27271070e-002  
-5.54249547e-002  
-5.82210310e-002  
-6.11154400e-002  
-6.41156808e-002  
-6.72077462e-002  
-7.03900307e-002  
-7.36476928e-002  
-7.69791305e-002  
-8.03707540e-002  
-8.38197023e-002  
-8.73127282e-002  
-9.08465236e-002  
-9.44096297e-002  
-9.80026722e-002  
-1.01638980e-001  
-1.05341621e-001  ]';
%}


figure(3)
plot(x,abs(y),x,abs(y_SW)); %ploteo comparando deflexiones
grid on
figure(4)
plot(x,abs(sigma),x,abs(ten_SW)); %ploteo comparando tensiones
grid on